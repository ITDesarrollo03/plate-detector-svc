<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <add name="httpPlatformHandler" path="*" verb="*"
           modules="httpPlatformHandler" resourceType="Unspecified"
           requireAccess="Script" />
    </handlers>
    <httpPlatform processPath="C:\inetpub\wwwroot\PlateDetector\venv\Scripts\python.exe"
                  arguments="-m uvicorn app.main:app --host 127.0.0.1 --port %HTTP_PLATFORM_PORT%"
                  stdoutLogEnabled="true"
                  stdoutLogFile="C:\inetpub\wwwroot\PlateDetector\logs\stdout.log"
                  startupTimeLimit="60"
                  requestTimeout="00:02:00">
      <environmentVariables>
        <environmentVariable name="PYTHONUNBUFFERED" value="1" />
        <environmentVariable name="MODEL_PATH" value="C:\inetpub\wwwroot\PlateDetector\models\plate-detector.pt" />
        <environmentVariable name="DEBUG_DIR" value="C:\inetpub\wwwroot\PlateDetector\debug_plates" />
        <environmentVariable name="TESSERACT_CMD" value="C:\Program Files\Tesseract-OCR\tesseract.exe" />
        <environmentVariable name="TESSDATA_PREFIX" value="C:\Program Files\Tesseract-OCR\tessdata" />
      </environmentVariables>
    </httpPlatform>

    <!-- Disable compression for streaming responses -->
    <urlCompression doStaticCompression="false" doDynamicCompression="false" />

    <!-- Increase upload limits for image files -->
    <security>
      <requestFiltering>
        <requestLimits maxAllowedContentLength="52428800" /> <!-- 50 MB -->
      </requestFiltering>
    </security>
  </system.webServer>
</configuration>
